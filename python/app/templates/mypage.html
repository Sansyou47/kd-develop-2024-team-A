<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éû„Ç§„Éö„Éº„Ç∏</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    {% include "header.html" %}

    <!-- „Çø„Éñ„ÅÆÈñ¢Êï∞-->
    <script>
        let currentTab = 1; // ÂàùÊúüË°®Á§∫„Çø„Éñ
        function switchTab(tabNumber) {
            const tabContent = document.getElementById(`tab${tabNumber}`);
            const tabButton = document.getElementById(`tabButton${tabNumber}`);

            if (currentTab === tabNumber && !tabContent.classList.contains('hidden')) {
                //„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
                tabContent.classList.add('hidden');
                //„Éú„Çø„É≥„ÇíÈùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Åô„Çã
                tabButton.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                tabButton.classList.add('text-gray-500');
                currentTab = null
                return;
            }

            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Éú„Çø„É≥„Åã„ÇâÈÅ∏ÊäûÁä∂ÊÖã„ÇíËß£Èô§
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                button.classList.add('text-gray-500');
            });

            // ÈÅ∏Êäû„Åó„Åü„Çø„Éñ„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            document.getElementById(`tab${tabNumber}`).classList.remove('hidden');
            // ÈÅ∏Êäû„Åó„Åü„Çø„Éñ„Éú„Çø„É≥„Çí„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„Å´
            document.getElementById(`tabButton${tabNumber}`).classList.remove('text-gray-500');
            document.getElementById(`tabButton${tabNumber}`).classList.add('text-blue-600', 'border-b-2', 'border-blue-600');

            currentTab = tabNumber;
        }
    </script>
    <!-- „Çø„Éñ„ÅÆÈñ¢Êï∞ „Åä„Çè„Çä -->

</head>

<body class="flex flex-col min-h-screen bg-orange-100">
    <main>
        <div class="">
            <!-- „Éó„É≠„Éï„Ç£„Éº„É´ -->
            <!-- Ë¶ÅÁ¥†„ÇíÊ®™„Å´ÈÖçÁΩÆ -->
            <div class="flex justify-left mx-4 ">
                <!-- ÂÜÜÂΩ¢„ÅÆÊû†„Åß„Ç¢„Ç§„Ç≥„É≥ÁîªÂÉè -->
                <h1 class="rounded-full w-20 h-20 text-center bg-gray-500 ">
                    <img src="../static/images/CameraIcon.jpeg" alt="„Ç¢„Ç§„Ç≥„É≥ÁîªÂÉè" class="rounded-full w-20 h-20">
                </h1>
                <!-- Ë¶ÅÁ¥†„ÇíÁ∏¶„Å´ÈÖçÁΩÆ -->
                <div class="flex-col items-center w-1/2 ml-2 ">

                    <nobr>
                        <h2 class="text-3xl font-semibold overflow-x-auto overflow-y-hidden">
                            {{ session.user_name }}
                        </h2>
                    </nobr>
                    <nobr>
                        <p class="text-sm underline decoration-slate-50 overflow-x-auto overflow-y-hidden">
                            {{session.user_email}}</p>
                    </nobr>
                </div>
                <p class="flex justify-center items-center ml-4 text-lg text-blue-500 font-bold ">
                    <!-- /signup„Å´È£õ„Å∂ -->
                    <a href="/signup">
                        „Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥
                    </a>
                </p>
            </div>
            <!-- „Éó„É≠„Éï„Ç£„Éº„É´ „Åä„Çè„Çä -->

            <!-- „Çø„Éñ -->
            <div class="flex justify-left mt-4">
                <button id="tabButton1"
                    class="tab-button text-blue-600 border-b-2 border-blue-600 py-2 px-4 font-medium text-sm focus:outline-none"
                    onclick="switchTab(1)">
                    „ÇΩ„Éº„Éà„Éª„Éï„Ç£„É´„Çø„Éº
                </button>
                <!-- „Çø„Éñ„ÇíÂ¢ó„ÇÑ„ÅôÂ†¥Âêà„Ç≥„É°„É≥„Éà„ÇíÂ§ñ„Åô -->
                <script>
                    // <button id="tabButton2"
                    //     class="tab-button text-gray-500 hover:text-gray-700 py-2 px-4 font-medium text-sm focus:outline-none"
                    //     onclick="switchTab(2)">
                    //     „Åù„ÅÆ‰ªñ
                    // </button>
                </script>
            </div>

            <div class="p-6">
                <div id="tab1" class="tab-content">
                    <div class="">
                        <!-- „ÇΩ„Éº„Éà -->
                        <div class=" flex justify-left border border-black">
                            <div class="flex-col">
                                <form action="/mypage" method="POST" id="sortDorP">
                                    <!-- Êó•‰ªòorÁÇπÊï∞ ÂàùÊúüÂÄ§Êó•‰ªò -->
                                    <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                                    <select id="sortOrder" name="sort_type"
                                        onchange="document.getElementById('sortDorP').submit()">
                                        <option value="date" {% if sort_type=="date" %}selected{% endif %}> Êó•‰ªòÈ†Ü</option>
                                        <option value="score" {% if sort_type=="score" %}selected{% endif %}>ÁÇπÊï∞È†Ü
                                        </option>
                                        <!-- <option value="ü¶Ä" {% if sort_type=="ü¶Ä" %}selected{% endif %}>„Çø„É©„Éê„Ç¨„ÉãÈ†Ü</option> -->
                                    </select>
                                </form>

                                <form action="/mypage" method="POST" id="sortAscDesc">
                                    <input type="hidden" name="sort_type" value="{{ sort_type }}">

                                    <!-- ÊòáorÈôçÈ†Ü ÂàùÊúüÂÄ§ÈôçÈ†Ü -->
                                    <select id="sortDirection" name="sort_direction"
                                        onchange="document.getElementById('sortAscDesc').submit()">
                                        <option value="desc" {% if sort_direction=="desc" %}selected{% endif %}>ÈôçÈ†Ü
                                        </option>
                                        <option value="asc" {% if sort_direction=="asc" %}selected{% endif %}>ÊòáÈ†Ü
                                        </option>
                                        <!-- <option value="ü¶Ä" {% if sort_direction=="ü¶Ä" %}selected{% endif %}>„Ç∫„ÉØ„Ç§„Ç¨„ÉãÈ†Ü</option> -->
                                    </select>
                                </form>
                            </div>
                        </div>
                        <!-- „ÇΩ„Éº„Éà „Åä„Çè„Çä -->

                    </div>
                </div>
                <!-- „Çø„Éñ„ÇíÂ¢ó„ÇÑ„ÅôÂ†¥Âêà„ÄÅ„Ç≥„É°„É≥„Éà„ÇíÂ§ñ„Åô -->
                <script>
                    //     <div id="tab2" class="tab-content hidden">
                    //         <h2 class="text-xl font-bold mb-4">„Çø„Éñ2„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ</h2>
                    //         <p>„Åì„Åì„Å´„Çø„Éñ2„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅåÂÖ•„Çä„Åæ„Åô„ÄÇ</p>
                    //     </div>
                    // </div>
                </script>
                <!-- „Çø„Éñ „Åä„Çè„Çä -->


                {% if mypage_result_zen %}
                <!-- Â±•Ê≠¥‰∏ÄË¶ß„Ç≥„É≥„ÉÜ„Éä -->
                <div id="bentoContainer" class="flex-col items-center">
                    <div id="bentoContainer" class="flex-col items-center">
                        {% for id,score,token_point, bento_url, create_date in mypage_result_zen %}
                        <!-- Â±•Ê≠¥Ë¶ÅÁ¥† -->
                        <!--Ê®™ -->

                        <div class="bento-item flex justify-left mx-8 my-2 rounded bg-white shadow-md cursor-pointer"
                            data-score="{{ score }}" data-date="{{ create_date }}"
                            onclick="showScoreDetails('{{ id }}', '{{ score }}', '{{ bento_url }}', '{{ create_date }}', '{{token_point}}')">
                            <h1 class="flex items-center justify-center mx-1 my-1 w-20 h-20 text-center">
                                <img src="{{ bento_url }}" alt="Bento Image">
                            </h1>
                            <!-- Á∏¶ -->
                            <div class="flex-col items-center ml-2 ">
                                <h2 class="text-sm font-semibold mt-2">
                                    <!-- „ÅäÂºÅÂΩìÂêçÈÄ£Áï™ -->
                                    „ÅäÂºÅÂΩì{{ loop.index + ((page - 1) * page_contents) }}
                                </h2>
                                <div class="flex justify-left">
                                    <p class="text-4xl font-bold mt-2">
                                        {{ score }}ÁÇπ
                                    </p>
                                    <p class="flex items-end ml-4 text-right text-xs">
                                        {{ create_date }}<br>
                                        {{token_point}}
                                    </p>
                                </div>
                            </div>

                        </div>

                        {% endfor %}
                    </div>
                    {% else %}
                    <p>„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
                    {% endif %}

                    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„ÅÆ„É™„É≥„ÇØ -->
                    <div class="flex flex-wrap justify-center items-center gap-1 p-4">
                        <form action="/mypage" method="POST" class="m-2">
                            <input type="hidden" name="page" value="1">
                            <input type="hidden" name="sort_type" value="{{ sort_type }}">
                            <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-blue-500 bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                << </button>
                        </form>


                        <!-- page-2„Åå0„Å´„Å™„ÇãÂ†¥Âêà„ÄÅË°®Á§∫„Åó„Å™„ÅÑ -->
                        {% if page - 2 > 0 %}
                        <form action="/mypage" method="POST" class="m-1">
                            <input type="hidden" name="page" value="{{ page - 2 }}">
                            <input type="hidden" name="sort_type" value="{{ sort_type }}">
                            <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-blue-500 bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                {{ page - 2 }}
                            </button>
                        </form>
                        {% endif %}

                        <!-- page-1„Åå0„Å´„Å™„ÇãÂ†¥Âêà„ÄÅË°®Á§∫„Åó„Å™„ÅÑ -->
                        {% if page - 1 > 0 %}
                        <form action="/mypage" method="POST" class="m-1">
                            <input type="hidden" name="page" value="{{ page - 1 }}">
                            <input type="hidden" name="sort_type" value="{{ sort_type }}">
                            <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-blue-500 bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                {{ page - 1 }}
                            </button>
                        </form>
                        {% endif %}

                        <!-- ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏ -->
                        <div class="m-1">
                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-black bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                {{ page }}
                            </button>
                        </div>
                        <!-- ‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãÂÖ®„Å¶„ÅÆ„ÅäÂºÅÂΩì„ÅÆ„Éá„Éº„ÇøÊï∞ÔºûÁèæÂú®„Éö„Éº„Ç∏*Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„ÅäÂºÅÂΩì„ÅÆ„Éá„Éº„ÇøÊï∞„ÄÄ„ÅÆ„Å®„Åç Ë°®Á§∫„Åô„Çã-->
                        {% if mypage_data_size > page * page_contents %}
                        <!-- „Éö„Éº„Ç∏„É≥„Ç∞„ÅÆÈöõ„Å´page„Å®sort_type„Å®sort_direction„ÇíPOST„ÅßÈÄÅ„Çã -->
                        <form action="/mypage" method="POST" class="m-1">
                            <input type="hidden" name="page" value="{{ page + 1 }}">
                            <input type="hidden" name="sort_type" value="{{ sort_type }}">
                            <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-blue-500 bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                {{ page + 1 }}
                            </button>
                        </form>

                        {% endif %}

                        {% if mypage_data_size > page * page_contents + 5 %}
                        <form action="/mypage" method="POST" class="m-1">
                            <input type="hidden" name="page" value="{{ page + 2 }}">
                            <input type="hidden" name="sort_type" value="{{ sort_type }}">
                            <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-blue-500 bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                {{ page + 2 }}
                            </button>
                        </form>
                        {% endif %}
                        <!-- ÊúÄÁµÇ„Éö„Éº„Ç∏ „Å´È£õ„Å∂-->
                        <!-- ‰Ωô„Å£„Åü„Éö„Éº„Ç∏„Åå„Å™„ÅÑÂ†¥Âêà -->
                        {% if mypage_data_size // page_contents == 0 %}
                        <form action="/mypage" method="POST" class="m-2">
                            <input type="hidden" name="page" value="{{ mypage_data_size // page_contents }}">
                            <input type="hidden" name="sort_type" value="{{ sort_type }}">
                            <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-blue-500 bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                >>
                            </button>
                        </form>

                        <!-- ‰Ωô„Çä„Éö„Éº„Ç∏„Åå„ÅÇ„ÇãÂ†¥Âêà -->
                        {% else %}
                        <form action="/mypage" method="POST" class="m-2">
                            <input type="hidden" name="page" value="{{ mypage_data_size // page_contents + 1 }}">
                            <input type="hidden" name="sort_type" value="{{ sort_type }}">
                            <input type="hidden" name="sort_direction" value="{{ sort_direction }}">

                            <button type="submit"
                                class="w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center text-sm text-blue-500 bg-gray-200 hover:bg-gray-300 border border-gray-800 rounded-md">
                                >>
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„ÅÆ„É™„É≥„ÇØ „Åä„Çè„Çä -->
                </div>
    </main>
    {% include "footer.html" %}

    <!-- Êé°ÁÇπÁµêÊûúÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden" onclick="closeScoreDetails()"></div>
    <div id="scoreDetails" class="fixed inset-0 flex justify-center items-center z-40 hidden pointer-events-none">
        <div class="bg-white rounded-lg p-6 w-11/12 md:w-1/2 lg:w-1/3 pointer-events-auto">
            <div class="flex justify-between mb-4"> <!-- „Éú„Çø„É≥„ÇíÂè≥ÂØÑ„Åõ -->
                <h2 class="text-xl font-bold mb-4">Êé°ÁÇπÁµêÊûú</h2>
                <button class="bg-blue-500 text-white w-10 h-10 rounded-full" onclick="closeScoreDetails()">‚úï</button>
            </div>

            <div id="scoreContent"></div>
            <form action="/mypage/log" method="post" enctype="multipart/form-data">
                <input type="hidden" id="hidden_id" name="id" value="{{id}}">
                <input type="hidden" id="hidden_score" name="score" value="{{score}}">
                <input type="hidden" id="hidden_token_point" name="token_point" value=" {{token_point}}">
                <input type="hidden" id="hidden_bento_url" name="bento_url" value="{{bento_url}}">
                <input class="mt-4 bg-blue-500 text-white py-2 px-4 rounded cursor-pointer" type="submit"
                    value="Ë©≥Á¥∞„Éö„Éº„Ç∏„Å∏">
            </form>
        </div>
    </div>

    <script>
        const hiddenId = document.getElementById('hidden_id');
        const hiddenScore = document.getElementById('hidden_score');
        const hiddenTokenPoint = document.getElementById('hidden_token_point');
        const hiddenBentoUrl = document.getElementById('hidden_bento_url');

        const overlay = document.getElementById('overlay');
        const scoreDetails = document.getElementById('scoreDetails');

        function showScoreDetails(id, score, bentoUrl, date, tokenPoint) {
            document.getElementById("scoreContent").innerHTML = `
            <p><strong>ÁÇπÊï∞:</strong> ${score} ${tokenPoint}</p>
            <p><strong>Êó•‰ªò:</strong> ${date}</p>
            <img src="${bentoUrl}" alt="Bento Image" class="w-full h-auto mt-4 rounded-md">
        `;

            hiddenId.value = id;
            hiddenScore.value = score;
            hiddenTokenPoint.value = tokenPoint;
            hiddenBentoUrl.value = bentoUrl;
            overlay.classList.remove("hidden");
            scoreDetails.classList.remove("hidden");
        }

        function closeScoreDetails() {
            overlay.classList.add("hidden");
            scoreDetails.classList.add("hidden");
        }

    </script>
</body>

</html>